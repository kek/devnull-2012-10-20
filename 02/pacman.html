<html>
	<head>
		<title>Test</title>
		<!--  script src="lib/jquery-1.7.1.min.js"></script -->
		<style>

			body {
				background: #c0c0c0;
			}
		</style>
		<script>

		
		//$(document).ready(function(){
			
			//alert("fisk => "+rev("fisk"));
			//alert("fisk2 => "+rev("fisk2"));
		//});
		
		</script>
	</head>
	<body>
	<div id="test"></div>
	<canvas id="myCanvas" width="320" height="240"></canvas>

	<br> <a href="#">Seed</a>
	<script type="text/javascript" src="random.js"></script>
<script>
	
var tilesize = 20;
var mapInit = [
"################",
"#              #",
"#              #",
"#              #",
"#              #",
"#              #",
"#              #",
"# ############ #",
"# #            #",
"# ############ #",
"#              #",
"################"
];

var map = [];

function openUpMap(map) {
	var NUMHOLES = 3
	var rnd = new MersenneTwister(1);

	for(var i = 0; i < map.length; i++) {
		if(map[i].join("") == "# ############ #") {
			while(map[i].filter(function (cell) {
				console.log(cell);
				return cell == " ";
			}).length < NUMHOLES + 2) {
				var hole = 2 + Math.floor(rnd.random() * (map[i].length - 4));
				if(map[i][hole-1] == "#" && map[i][hole+1] == "#") {
					map[i][hole] = " ";
					console.log("adding hole");
				} else {
					console.log("not adding hole");
				}
			}
		}
	}
	return map;
}

function wallAt(x, y) {

	if (y < 0 || y >= map.length || x < 0 || x >= map[y].length) {
		return false;
	}

	return map[y][x] === "#";
}

var c = document.querySelector("canvas");
var context = c.getContext("2d");

function draw() {

	context.fillStyle = "black";
	context.fillRect(0, 0, 320, 240);

	context.fillStyle = "rgba(255, 255, 255, 0.3)";
	for (var y = 0; y < map.length; y++) {
		for (var x = 0; x < map[y].length; x++) {			
			context.fillRect(x * tilesize + 1, y * tilesize + 1, tilesize - 2, tilesize - 2);
		}		
	}


	for (var y = 0; y < map.length; y++) {
		for (var x = 0; x < map[y].length; x++) {			
			drawWalls(context, x, y);
		}		
	}

}

function drawWalls(context, x, y) {

	if (wallAt(x, y)) {

		var left = wallAt(x - 1, y);
		var top = wallAt(x, y - 1);
		var right = wallAt(x + 1, y);
		var bottom = wallAt(x, y + 1);
		var inset = 8; 

		context.fillStyle = "white";

		var rx;
		var ry; 
		var rw;
		var rh;

		if (left && right) {

			rx = x * tilesize;
			ry = y * tilesize + inset;
			rw = tilesize;
			rh = tilesize - inset - inset;

		} else if (left) {

			rx = x * tilesize;
			ry = y * tilesize + inset;
			rw = tilesize / 2;
			rh = tilesize - inset - inset;

		} else if (right) {

			console.log("right");

			var w2 = tilesize / 2 + inset;
			rx = x * tilesize + tilesize / 2;
			ry = y * tilesize + inset;
			rw = w2;
			rh = tilesize - inset - inset;

		}

		if (rx) {
				context.fillRect(rx, ry, rw, rh);
		}

		if (top && bottom) {

			rx = x * tilesize + inset;
			ry = y * tilesize;
			rw = tilesize - inset - inset;
			rh = tilesize;

		} else if (top) {

			rx = x * tilesize + inset;
			ry = y * tilesize;
			rw = tilesize - inset - inset;
			rh = tilesize / 2;

		} else if (bottom) {

			rx = x * tilesize + inset;
			ry = y * tilesize + tilesize / 2;
			rw = tilesize - inset - inset;
			rh = tilesize / 2;

		}

		if (rx) {
				context.fillRect(rx, ry, rw, rh);
		}
	}
}

function init( ) {
	for (var y = 0; y < mapInit.length; y++) {
		map.push(mapInit[y].split(""));
	}

	map = openUpMap(map);

	map.forEach(function (row) {
		console.log(row.join(""));
	});
}

init();
draw();
</script>

</html>
